<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body { font-family: sans-serif; padding: 20px; }
      .form-group { margin-bottom: 15px; }
      label { display: block; margin-bottom: 5px; font-weight: bold; }
      input, textarea { width: 100%; padding: 8px; box-sizing: border-box; }
      textarea { height: 150px; }
      button { padding: 10px 20px; background-color: #007bff; color: white; border: none; cursor: pointer; }
      button:hover { background-color: #0056b3; }
      #status { margin-top: 20px; font-weight: bold; }
    </style>
  </head>
  <body>
    <h2>CUOnline Admin - Roster Push</h2>
    
    <div class="form-group">
      <label>Course ID (e.g., 30000)</label>
      <input type="text" id="courseId" required>
    </div>
    
    <div class="form-group">
      <label>Course Name (e.g., CSC462 - AI)</label>
      <input type="text" id="courseName" required>
    </div>
    
    <div class="form-group">
      <label>Section (e.g., A)</label>
      <input type="text" id="section" required>
    </div>
    
    <div class="form-group">
      <label>Student List (Paste from Portal)</label>
      <div style="font-size: 0.8em; color: #666; margin-bottom: 5px;">
        Format: Reg No [tab] Name (one per line)<br>
        Example:<br>
        FA22-BCS-008    AQSA HANIF
      </div>
      <textarea id="studentList" placeholder="Paste student list here..."></textarea>
    </div>
    
    <button onclick="submitRoster()">Push Roster</button>
    
    <div id="status"></div>

    <script>
      function submitRoster() {
        const status = document.getElementById('status');
        status.textContent = 'Processing...';
        status.style.color = 'blue';

        const courseId = document.getElementById('courseId').value;
        const courseName = document.getElementById('courseName').value;
        const section = document.getElementById('section').value;
        const rawList = document.getElementById('studentList').value;

        if (!courseId || !courseName || !section || !rawList) {
          status.textContent = 'Please fill all fields';
          status.style.color = 'red';
          return;
        }

        // Parse student list
        const students = rawList.trim().split('\n').map(line => {
          // Improve parsing logic based on real data format, assuming tab or space separation
          const parts = line.split(/\t+/); 
          if (parts.length < 2) return null;
          return {
            reg: parts[0].trim(),
            name: parts[1].trim()
          };
        }).filter(s => s !== null);

        const payload = {
          courseId: courseId,
          course: courseName,
          section: section,
          students: students,
          pushedAt: new Date().toISOString()
        };

        google.script.run
          .withSuccessHandler(onSuccess)
          .withFailureHandler(onFailure)
          .saveRoster(payload);
      }

      function onSuccess(result) {
        const status = document.getElementById('status');
        status.textContent = 'Success! Roster saved. ' + result.fileName;
        status.style.color = 'green';
        document.getElementById('studentList').value = '';
      }

      function onFailure(error) {
        const status = document.getElementById('status');
        status.textContent = 'Error: ' + error.message;
        status.style.color = 'red';
      }
    </script>
  </body>
</html>
